<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tesla Dash v6 Final</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #000; color: #fff; height: 100vh; overflow: hidden; margin: 0; }
        .dashboard-card { background: #111; border: 1px solid #222; border-radius: 1.25rem; overflow: hidden; }
        .emergency-item { background: #1a1111; border: 1px solid #331a1a; display: block; text-decoration: none; color: white; margin-bottom: 6px; }
        ::-webkit-scrollbar { display: none; }
        iframe { border: 0; }
    </style>
</head>
<body class="p-4 flex flex-col gap-4">

    <header class="h-16 flex justify-between items-center px-4">
        <div class="flex items-baseline gap-4">
            <div id="clock" class="text-6xl font-bold tracking-tighter">00:00</div>
            <div id="date" class="text-lg text-gray-500 font-medium border-l border-gray-800 pl-4">Loading...</div>
        </div>
        <div class="flex gap-10 text-right">
            <div>
                <p class="text-[10px] text-gray-500 uppercase font-bold tracking-widest">PM 2.5 Index</p>
                <p id="pm25-val" class="text-2xl font-bold text-yellow-500">--</p>
            </div>
            <div class="border-l border-gray-800 pl-10 text-green-500">
                <p class="text-[10px] text-gray-500 uppercase font-bold tracking-widest">Tesla Browser</p>
                <p class="text-xl font-bold">STABLE</p>
            </div>
        </div>
    </header>

    <main class="flex-1 grid grid-cols-10 gap-4 overflow-hidden">
        
        <section class="col-span-3 flex flex-col gap-4">
            <div class="h-1/3 dashboard-card p-4 flex flex-col justify-between">
                <div class="flex justify-between items-center">
                    <div>
                        <p id="temp-main" class="text-5xl font-bold">--¬∞</p>
                        <p id="weather-desc" class="text-xs text-gray-400 capitalize">Loading...</p>
                    </div>
                    <span id="weather-icon" class="text-6xl">üå§Ô∏è</span>
                </div>
                <div id="forecast-row" class="flex justify-between border-t border-gray-800 pt-3 text-center text-[10px] text-gray-500 uppercase">
                    <p class="w-full">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏Å‡∏≤‡∏®...</p>
                </div>
            </div>
            <div class="flex-1 dashboard-card relative">
                <iframe width="100%" height="100%" src="https://embed.windy.com/embed2.html?lat=13.750&lon=100.517&detailLat=13.750&detailLon=100.517&width=650&height=450&zoom=10&level=surface&overlay=radar&product=radar&menu=&message=&marker=&calendar=now&pressure=&type=map&location=coordinates&detail=&metricWind=default&metricTemp=default&radarRange=-1" frameborder="0"></iframe>
                <div class="absolute top-2 left-2 bg-black/80 px-2 py-1 rounded text-[10px] text-blue-400 font-bold uppercase">Rain Radar (Windy)</div>
            </div>
        </section>

        <section class="col-span-3 flex flex-col gap-4">
            <div class="h-1/3 dashboard-card p-4 flex flex-col justify-center items-center">
                <p class="text-[10px] text-gray-500 font-bold uppercase mb-1">Nearest Supercharger</p>
                <p class="text-5xl font-bold text-green-500">8 <span class="text-xl text-gray-700">/ 12</span></p>
                <p class="text-sm text-gray-300 mt-1 italic font-medium">Central Rama 9</p>
            </div>
            <div class="flex-1 dashboard-card p-4 flex flex-col gap-1 overflow-y-auto">
                <p class="text-[10px] text-red-500 font-bold uppercase text-center mb-2 tracking-widest">Emergency Calls</p>
                <a href="tel:1669" class="emergency-item p-3 rounded-xl flex justify-between items-center"><div><p class="text-sm font-bold">1669</p><p class="text-[10px] opacity-60">‡πÄ‡∏à‡πá‡∏ö‡∏õ‡πà‡∏ß‡∏¢‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô</p></div><span>üìû</span></a>
                <a href="tel:1193" class="emergency-item p-3 rounded-xl flex justify-between items-center"><div><p class="text-sm font-bold">1193</p><p class="text-[10px] opacity-60">‡∏ï‡∏≥‡∏£‡∏ß‡∏à‡∏ó‡∏≤‡∏á‡∏´‡∏•‡∏ß‡∏á</p></div><span>üìû</span></a>
                <a href="tel:1543" class="emergency-item p-3 rounded-xl flex justify-between items-center"><div><p class="text-sm font-bold">1543</p><p class="text-[10px] opacity-60">‡∏£‡∏ñ‡πÄ‡∏™‡∏µ‡∏¢‡∏ó‡∏≤‡∏á‡∏î‡πà‡∏ß‡∏ô</p></div><span>üìû</span></a>
                <a href="tel:1146" class="emergency-item p-3 rounded-xl flex justify-between items-center"><div><p class="text-sm font-bold">1146</p><p class="text-[10px] opacity-60">‡∏ó‡∏≤‡∏á‡∏´‡∏•‡∏ß‡∏á‡∏ä‡∏ô‡∏ö‡∏ó</p></div><span>üìû</span></a>
                <a href="tel:199" class="emergency-item p-3 rounded-xl flex justify-between items-center"><div><p class="text-sm font-bold">199</p><p class="text-[10px] opacity-60">‡∏Å‡∏π‡πâ‡∏†‡∏±‡∏¢/‡∏î‡∏±‡∏ö‡πÄ‡∏û‡∏•‡∏¥‡∏á</p></div><span>üìû</span></a>
            </div>
        </section>

        <section class="col-span-4 dashboard-card flex flex-col">
            <div class="p-4 border-b border-gray-800 bg-[#151515] flex justify-between items-center">
                <h2 class="text-blue-400 font-bold text-sm tracking-widest uppercase">üê¶ Traffic Twitter Feed</h2>
                <span class="text-[9px] text-gray-600">JS100 RADIO</span>
            </div>
            <div class="flex-1 overflow-hidden">
                <iframe id="twitter-frame" src="https://nitter.poast.org/js100radio" width="100%" height="100%" style="filter: invert(90%) hue-rotate(180deg) brightness(0.9);"></iframe>
            </div>
        </section>
    </main>

    <footer class="h-6 flex items-center px-4 text-[9px] text-gray-600 uppercase tracking-widest">
        Auto-update mode: ON | Location: Bangkok, TH | Radar: Windy | Weather: OpenWeatherMap
    </footer>

    <script>
        const OWM_KEY = '291abd3340d40fa520f4240eb08313da';
        const WAQI_TOKEN = '58ffca1bf9a4b7549d05e194a3b8d93c5b558e62';
        const LAT = 13.7563; 
        const LON = 100.5018;

        function updateClock() {
            const now = new Date();
            const h = now.getHours().toString().padStart(2, '0');
            const m = now.getMinutes().toString().padStart(2, '0');
            const dayNames = ['‡∏ß‡∏±‡∏ô‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå', '‡∏ß‡∏±‡∏ô‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå', '‡∏ß‡∏±‡∏ô‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£', '‡∏ß‡∏±‡∏ô‡∏û‡∏∏‡∏ò', '‡∏ß‡∏±‡∏ô‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ', '‡∏ß‡∏±‡∏ô‡∏®‡∏∏‡∏Å‡∏£‡πå', '‡∏ß‡∏±‡∏ô‡πÄ‡∏™‡∏≤‡∏£‡πå'];
            const monthNames = ['‡∏°.‡∏Ñ.', '‡∏Å.‡∏û.', '‡∏°‡∏µ.‡∏Ñ.', '‡πÄ‡∏°.‡∏¢.', '‡∏û.‡∏Ñ.', '‡∏°‡∏¥.‡∏¢.', '‡∏Å.‡∏Ñ.', '‡∏™.‡∏Ñ.', '‡∏Å.‡∏¢.', '‡∏ï.‡∏Ñ.', '‡∏û.‡∏¢.', '‡∏ò.‡∏Ñ.'];
            document.getElementById('clock').textContent = `${h}:${m}`;
            document.getElementById('date').textContent = `${dayNames[now.getDay()]} ${now.getDate()} ${monthNames[now.getMonth()]}`;
        }

        async function fetchWeather() {
            try {
                // Fetch Current Weather
                const res = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${LAT}&lon=${LON}&appid=${OWM_KEY}&units=metric&lang=th`);
                
                if (!res.ok) {
                    throw new Error(`HTTP error! status: ${res.status}`);
                }
                
                const data = await res.json();
                
                if(data.cod === 200 && data.main && data.weather) {
                    document.getElementById('temp-main').textContent = Math.round(data.main.temp) + '¬∞';
                    document.getElementById('weather-desc').textContent = data.weather[0].description;
                    
                    // Update weather icon based on condition
                    const iconMap = {
                        '01d': '‚òÄÔ∏è', '01n': 'üåô', '02d': '‚õÖ', '02n': '‚òÅÔ∏è',
                        '03d': '‚òÅÔ∏è', '03n': '‚òÅÔ∏è', '04d': '‚òÅÔ∏è', '04n': '‚òÅÔ∏è',
                        '09d': 'üåßÔ∏è', '09n': 'üåßÔ∏è', '10d': 'üå¶Ô∏è', '10n': 'üåßÔ∏è',
                        '11d': '‚õàÔ∏è', '11n': '‚õàÔ∏è', '13d': '‚ùÑÔ∏è', '13n': '‚ùÑÔ∏è',
                        '50d': 'üå´Ô∏è', '50n': 'üå´Ô∏è'
                    };
                    const iconCode = data.weather[0].icon;
                    document.getElementById('weather-icon').textContent = iconMap[iconCode] || 'üå§Ô∏è';
                } else {
                    throw new Error('Invalid weather data');
                }

                // Fetch Forecast
                const resF = await fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${LAT}&lon=${LON}&appid=${OWM_KEY}&units=metric&lang=th`);
                
                if (!resF.ok) {
                    throw new Error(`Forecast HTTP error! status: ${resF.status}`);
                }
                
                const dataF = await resF.json();
                
                if(dataF.cod === "200" && dataF.list && dataF.list.length > 0) {
                    const forecastRow = document.getElementById('forecast-row');
                    forecastRow.innerHTML = '';
                    dataF.list.slice(1, 5).forEach(item => {
                        const time = new Date(item.dt * 1000).getHours() + ':00';
                        const temp = Math.round(item.main.temp) + '¬∞';
                        forecastRow.innerHTML += `<div><p>${time}</p><p>üå°Ô∏è</p><p class="font-bold">${temp}</p></div>`;
                    });
                } else {
                    document.getElementById('forecast-row').innerHTML = '<p class="w-full">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡πÑ‡∏î‡πâ</p>';
                }
            } catch (e) { 
                console.error("Weather Error:", e);
                document.getElementById('temp-main').textContent = '--¬∞';
                document.getElementById('weather-desc').textContent = `‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${e.message}`;
                document.getElementById('forecast-row').innerHTML = '<p class="w-full text-red-400">‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</p>';
            }
        }

        async function fetchAQI() {
            try {
                const res = await fetch(`https://api.waqi.info/feed/geo:${LAT};${LON}/?token=${WAQI_TOKEN}`);
                
                if (!res.ok) {
                    throw new Error(`HTTP error! status: ${res.status}`);
                }
                
                const data = await res.json();
                
                if(data.status === "ok" && data.data && data.data.aqi) {
                    const aqi = data.data.aqi;
                    document.getElementById('pm25-val').textContent = aqi;
                    
                    // Color code based on AQI value
                    const aqiEl = document.getElementById('pm25-val');
                    if (aqi <= 50) aqiEl.className = 'text-2xl font-bold text-green-500';
                    else if (aqi <= 100) aqiEl.className = 'text-2xl font-bold text-yellow-500';
                    else if (aqi <= 150) aqiEl.className = 'text-2xl font-bold text-orange-500';
                    else aqiEl.className = 'text-2xl font-bold text-red-500';
                } else {
                    throw new Error('Invalid AQI data');
                }
            } catch (e) { 
                console.error("AQI Error:", e);
                document.getElementById('pm25-val').textContent = "ERR";
                document.getElementById('pm25-val').className = 'text-2xl font-bold text-gray-600';
            }
        }

        // Initialize
        updateClock();
        fetchWeather();
        fetchAQI();
        setInterval(updateClock, 1000);
        setInterval(fetchWeather, 600000); // 10 mins
        setInterval(fetchAQI, 600000); // 10 mins

        // Auto-refresh Twitter Feed every 5 mins
        setInterval(() => {
            document.getElementById('twitter-frame').src = document.getElementById('twitter-frame').src;
        }, 300000);
    </script>
</body>
</html>
